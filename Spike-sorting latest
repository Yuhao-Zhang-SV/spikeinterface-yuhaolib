{"cells":[{"cell_type":"markdown","metadata":{"id":"EGAJ4WRb8tqj"},"source":["First three cells are setup cells. "]},{"cell_type":"code","execution_count":null,"metadata":{"colab":{"base_uri":"https://localhost:8080/"},"executionInfo":{"elapsed":3326,"status":"ok","timestamp":1643758517966,"user":{"displayName":"Jay Reddy","photoUrl":"https://lh3.googleusercontent.com/a-/AOh14Gi6JEyxGNu8cAXlWGf5Y-I1bMTb0Q8xKMo-PB10FA=s64","userId":"04816875594114725413"},"user_tz":300},"id":"kK7LG_-PObLe","outputId":"b8e0ad55-823f-43d7-ae8e-f73f9c48ae01"},"outputs":[{"name":"stdout","output_type":"stream","text":["Mounted at /content/drive\n"]}],"source":["from google.colab import drive\n","# drive.flush_and_unmount()\n","drive.mount('/content/drive', force_remount=True)\n","\n","# This loads your google drive folder to /content/drive \n","# If you add our shared ephys folder to this, you will be able to find the recordings in \n","# /content/drive/Ephys data"]},{"cell_type":"code","execution_count":null,"metadata":{"colab":{"base_uri":"https://localhost:8080/"},"executionInfo":{"elapsed":44747,"status":"ok","timestamp":1643758564574,"user":{"displayName":"Jay Reddy","photoUrl":"https://lh3.googleusercontent.com/a-/AOh14Gi6JEyxGNu8cAXlWGf5Y-I1bMTb0Q8xKMo-PB10FA=s64","userId":"04816875594114725413"},"user_tz":300},"id":"1bCoSKeWOYMr","outputId":"95e281b0-c992-4e8c-c15f-894c0f9aa62b"},"outputs":[{"name":"stdout","output_type":"stream","text":["Collecting openpyxl==3.0.9\n","  Downloading openpyxl-3.0.9-py2.py3-none-any.whl (242 kB)\n","\u001b[?25l\r\u001b[K     |█▍                              | 10 kB 14.6 MB/s eta 0:00:01\r\u001b[K     |██▊                             | 20 kB 5.9 MB/s eta 0:00:01\r\u001b[K     |████                            | 30 kB 2.9 MB/s eta 0:00:01\r\u001b[K     |█████▍                          | 40 kB 3.7 MB/s eta 0:00:01\r\u001b[K     |██████▊                         | 51 kB 3.9 MB/s eta 0:00:01\r\u001b[K     |████████▏                       | 61 kB 4.2 MB/s eta 0:00:01\r\u001b[K     |█████████▌                      | 71 kB 4.0 MB/s eta 0:00:01\r\u001b[K     |██████████▉                     | 81 kB 4.5 MB/s eta 0:00:01\r\u001b[K     |████████████▏                   | 92 kB 4.4 MB/s eta 0:00:01\r\u001b[K     |█████████████▌                  | 102 kB 4.6 MB/s eta 0:00:01\r\u001b[K     |██████████████▉                 | 112 kB 4.6 MB/s eta 0:00:01\r\u001b[K     |████████████████▎               | 122 kB 4.6 MB/s eta 0:00:01\r\u001b[K     |█████████████████▋              | 133 kB 4.6 MB/s eta 0:00:01\r\u001b[K     |███████████████████             | 143 kB 4.6 MB/s eta 0:00:01\r\u001b[K     |████████████████████▎           | 153 kB 4.6 MB/s eta 0:00:01\r\u001b[K     |█████████████████████▋          | 163 kB 4.6 MB/s eta 0:00:01\r\u001b[K     |███████████████████████         | 174 kB 4.6 MB/s eta 0:00:01\r\u001b[K     |████████████████████████▍       | 184 kB 4.6 MB/s eta 0:00:01\r\u001b[K     |█████████████████████████▊      | 194 kB 4.6 MB/s eta 0:00:01\r\u001b[K     |███████████████████████████     | 204 kB 4.6 MB/s eta 0:00:01\r\u001b[K     |████████████████████████████▍   | 215 kB 4.6 MB/s eta 0:00:01\r\u001b[K     |█████████████████████████████▊  | 225 kB 4.6 MB/s eta 0:00:01\r\u001b[K     |███████████████████████████████▏| 235 kB 4.6 MB/s eta 0:00:01\r\u001b[K     |████████████████████████████████| 242 kB 4.6 MB/s \n","\u001b[?25hRequirement already satisfied: et-xmlfile in /usr/local/lib/python3.7/dist-packages (from openpyxl==3.0.9) (1.1.0)\n","Installing collected packages: openpyxl\n","  Attempting uninstall: openpyxl\n","    Found existing installation: openpyxl 2.5.9\n","    Uninstalling openpyxl-2.5.9:\n","      Successfully uninstalled openpyxl-2.5.9\n","Successfully installed openpyxl-3.0.9\n","Requirement already satisfied: spiketoolkit in /usr/local/lib/python3.7/dist-packages (0.7.7)\n","Requirement already satisfied: networkx in /usr/local/lib/python3.7/dist-packages (from spiketoolkit) (2.6.3)\n","Requirement already satisfied: spikemetrics>=0.2.4 in /usr/local/lib/python3.7/dist-packages (from spiketoolkit) (0.2.4)\n","Requirement already satisfied: numpy in /usr/local/lib/python3.7/dist-packages (from spiketoolkit) (1.19.5)\n","Requirement already satisfied: scipy in /usr/local/lib/python3.7/dist-packages (from spiketoolkit) (1.4.1)\n","Requirement already satisfied: spikefeatures in /usr/local/lib/python3.7/dist-packages (from spiketoolkit) (0.1.2)\n","Requirement already satisfied: scikit-learn in /usr/local/lib/python3.7/dist-packages (from spiketoolkit) (1.0.2)\n","Requirement already satisfied: joblib in /usr/local/lib/python3.7/dist-packages (from spiketoolkit) (1.1.0)\n","Requirement already satisfied: spikeextractors>=0.9.7 in /usr/local/lib/python3.7/dist-packages (from spiketoolkit) (0.9.9)\n","Requirement already satisfied: pandas in /usr/local/lib/python3.7/dist-packages (from spiketoolkit) (1.3.5)\n","Requirement already satisfied: tqdm in /usr/local/lib/python3.7/dist-packages (from spikeextractors>=0.9.7->spiketoolkit) (4.62.3)\n","Requirement already satisfied: python-dateutil>=2.7.3 in /usr/local/lib/python3.7/dist-packages (from pandas->spiketoolkit) (2.8.2)\n","Requirement already satisfied: pytz>=2017.3 in /usr/local/lib/python3.7/dist-packages (from pandas->spiketoolkit) (2018.9)\n","Requirement already satisfied: six>=1.5 in /usr/local/lib/python3.7/dist-packages (from python-dateutil>=2.7.3->pandas->spiketoolkit) (1.15.0)\n","Requirement already satisfied: threadpoolctl>=2.0.0 in /usr/local/lib/python3.7/dist-packages (from scikit-learn->spiketoolkit) (3.0.0)\n","Requirement already satisfied: spikewidgets in /usr/local/lib/python3.7/dist-packages (0.5.4)\n","Requirement already satisfied: MEAutility>=1.4.8 in /usr/local/lib/python3.7/dist-packages (from spikewidgets) (1.5.0)\n","Requirement already satisfied: spikeextractors>=0.9.7 in /usr/local/lib/python3.7/dist-packages (from spikewidgets) (0.9.9)\n","Requirement already satisfied: numpy in /usr/local/lib/python3.7/dist-packages (from spikewidgets) (1.19.5)\n","Requirement already satisfied: spikecomparison>=0.3.3 in /usr/local/lib/python3.7/dist-packages (from spikewidgets) (0.3.3)\n","Requirement already satisfied: spiketoolkit>=0.7.6 in /usr/local/lib/python3.7/dist-packages (from spikewidgets) (0.7.7)\n","Requirement already satisfied: matplotlib in /usr/local/lib/python3.7/dist-packages (from spikewidgets) (3.2.2)\n","Requirement already satisfied: pyyaml in /usr/local/lib/python3.7/dist-packages (from MEAutility>=1.4.8->spikewidgets) (3.13)\n","Requirement already satisfied: scipy in /usr/local/lib/python3.7/dist-packages (from spikecomparison>=0.3.3->spikewidgets) (1.4.1)\n","Requirement already satisfied: joblib in /usr/local/lib/python3.7/dist-packages (from spikecomparison>=0.3.3->spikewidgets) (1.1.0)\n","Requirement already satisfied: spikesorters>=0.4.5 in /usr/local/lib/python3.7/dist-packages (from spikecomparison>=0.3.3->spikewidgets) (0.4.5)\n","Requirement already satisfied: networkx in /usr/local/lib/python3.7/dist-packages (from spikecomparison>=0.3.3->spikewidgets) (2.6.3)\n","Requirement already satisfied: pandas in /usr/local/lib/python3.7/dist-packages (from spikecomparison>=0.3.3->spikewidgets) (1.3.5)\n","Requirement already satisfied: tqdm in /usr/local/lib/python3.7/dist-packages (from spikeextractors>=0.9.7->spikewidgets) (4.62.3)\n","Requirement already satisfied: requests in /usr/local/lib/python3.7/dist-packages (from spikesorters>=0.4.5->spikecomparison>=0.3.3->spikewidgets) (2.23.0)\n","Requirement already satisfied: spikefeatures in /usr/local/lib/python3.7/dist-packages (from spiketoolkit>=0.7.6->spikewidgets) (0.1.2)\n","Requirement already satisfied: scikit-learn in /usr/local/lib/python3.7/dist-packages (from spiketoolkit>=0.7.6->spikewidgets) (1.0.2)\n","Requirement already satisfied: spikemetrics>=0.2.4 in /usr/local/lib/python3.7/dist-packages (from spiketoolkit>=0.7.6->spikewidgets) (0.2.4)\n","Requirement already satisfied: kiwisolver>=1.0.1 in /usr/local/lib/python3.7/dist-packages (from matplotlib->spikewidgets) (1.3.2)\n","Requirement already satisfied: pyparsing!=2.0.4,!=2.1.2,!=2.1.6,>=2.0.1 in /usr/local/lib/python3.7/dist-packages (from matplotlib->spikewidgets) (3.0.7)\n","Requirement already satisfied: cycler>=0.10 in /usr/local/lib/python3.7/dist-packages (from matplotlib->spikewidgets) (0.11.0)\n","Requirement already satisfied: python-dateutil>=2.1 in /usr/local/lib/python3.7/dist-packages (from matplotlib->spikewidgets) (2.8.2)\n","Requirement already satisfied: six>=1.5 in /usr/local/lib/python3.7/dist-packages (from python-dateutil>=2.1->matplotlib->spikewidgets) (1.15.0)\n","Requirement already satisfied: pytz>=2017.3 in /usr/local/lib/python3.7/dist-packages (from pandas->spikecomparison>=0.3.3->spikewidgets) (2018.9)\n","Requirement already satisfied: certifi>=2017.4.17 in /usr/local/lib/python3.7/dist-packages (from requests->spikesorters>=0.4.5->spikecomparison>=0.3.3->spikewidgets) (2021.10.8)\n","Requirement already satisfied: chardet<4,>=3.0.2 in /usr/local/lib/python3.7/dist-packages (from requests->spikesorters>=0.4.5->spikecomparison>=0.3.3->spikewidgets) (3.0.4)\n","Requirement already satisfied: idna<3,>=2.5 in /usr/local/lib/python3.7/dist-packages (from requests->spikesorters>=0.4.5->spikecomparison>=0.3.3->spikewidgets) (2.10)\n","Requirement already satisfied: urllib3!=1.25.0,!=1.25.1,<1.26,>=1.21.1 in /usr/local/lib/python3.7/dist-packages (from requests->spikesorters>=0.4.5->spikecomparison>=0.3.3->spikewidgets) (1.24.3)\n","Requirement already satisfied: threadpoolctl>=2.0.0 in /usr/local/lib/python3.7/dist-packages (from scikit-learn->spiketoolkit>=0.7.6->spikewidgets) (3.0.0)\n","Requirement already satisfied: spikeextractors in /usr/local/lib/python3.7/dist-packages (0.9.9)\n","Requirement already satisfied: joblib in /usr/local/lib/python3.7/dist-packages (from spikeextractors) (1.1.0)\n","Requirement already satisfied: numpy in /usr/local/lib/python3.7/dist-packages (from spikeextractors) (1.19.5)\n","Requirement already satisfied: tqdm in /usr/local/lib/python3.7/dist-packages (from spikeextractors) (4.62.3)\n","Requirement already satisfied: spikesorters in /usr/local/lib/python3.7/dist-packages (0.4.5)\n","Requirement already satisfied: spikeextractors>=0.9.7 in /usr/local/lib/python3.7/dist-packages (from spikesorters) (0.9.9)\n","Requirement already satisfied: numpy in /usr/local/lib/python3.7/dist-packages (from spikesorters) (1.19.5)\n","Requirement already satisfied: requests in /usr/local/lib/python3.7/dist-packages (from spikesorters) (2.23.0)\n","Requirement already satisfied: spiketoolkit>=0.7.6 in /usr/local/lib/python3.7/dist-packages (from spikesorters) (0.7.7)\n","Requirement already satisfied: joblib in /usr/local/lib/python3.7/dist-packages (from spikeextractors>=0.9.7->spikesorters) (1.1.0)\n","Requirement already satisfied: tqdm in /usr/local/lib/python3.7/dist-packages (from spikeextractors>=0.9.7->spikesorters) (4.62.3)\n","Requirement already satisfied: spikefeatures in /usr/local/lib/python3.7/dist-packages (from spiketoolkit>=0.7.6->spikesorters) (0.1.2)\n","Requirement already satisfied: networkx in /usr/local/lib/python3.7/dist-packages (from spiketoolkit>=0.7.6->spikesorters) (2.6.3)\n","Requirement already satisfied: spikemetrics>=0.2.4 in /usr/local/lib/python3.7/dist-packages (from spiketoolkit>=0.7.6->spikesorters) (0.2.4)\n","Requirement already satisfied: pandas in /usr/local/lib/python3.7/dist-packages (from spiketoolkit>=0.7.6->spikesorters) (1.3.5)\n","Requirement already satisfied: scikit-learn in /usr/local/lib/python3.7/dist-packages (from spiketoolkit>=0.7.6->spikesorters) (1.0.2)\n","Requirement already satisfied: scipy in /usr/local/lib/python3.7/dist-packages (from spiketoolkit>=0.7.6->spikesorters) (1.4.1)\n","Requirement already satisfied: python-dateutil>=2.7.3 in /usr/local/lib/python3.7/dist-packages (from pandas->spiketoolkit>=0.7.6->spikesorters) (2.8.2)\n","Requirement already satisfied: pytz>=2017.3 in /usr/local/lib/python3.7/dist-packages (from pandas->spiketoolkit>=0.7.6->spikesorters) (2018.9)\n","Requirement already satisfied: six>=1.5 in /usr/local/lib/python3.7/dist-packages (from python-dateutil>=2.7.3->pandas->spiketoolkit>=0.7.6->spikesorters) (1.15.0)\n","Requirement already satisfied: chardet<4,>=3.0.2 in /usr/local/lib/python3.7/dist-packages (from requests->spikesorters) (3.0.4)\n","Requirement already satisfied: certifi>=2017.4.17 in /usr/local/lib/python3.7/dist-packages (from requests->spikesorters) (2021.10.8)\n","Requirement already satisfied: idna<3,>=2.5 in /usr/local/lib/python3.7/dist-packages (from requests->spikesorters) (2.10)\n","Requirement already satisfied: urllib3!=1.25.0,!=1.25.1,<1.26,>=1.21.1 in /usr/local/lib/python3.7/dist-packages (from requests->spikesorters) (1.24.3)\n","Requirement already satisfied: threadpoolctl>=2.0.0 in /usr/local/lib/python3.7/dist-packages (from scikit-learn->spiketoolkit>=0.7.6->spikesorters) (3.0.0)\n","Requirement already satisfied: spikecomparison in /usr/local/lib/python3.7/dist-packages (0.3.3)\n","Requirement already satisfied: spikesorters>=0.4.5 in /usr/local/lib/python3.7/dist-packages (from spikecomparison) (0.4.5)\n","Requirement already satisfied: networkx in /usr/local/lib/python3.7/dist-packages (from spikecomparison) (2.6.3)\n","Requirement already satisfied: spiketoolkit>=0.7.6 in /usr/local/lib/python3.7/dist-packages (from spikecomparison) (0.7.7)\n","Requirement already satisfied: pandas in /usr/local/lib/python3.7/dist-packages (from spikecomparison) (1.3.5)\n","Requirement already satisfied: scipy in /usr/local/lib/python3.7/dist-packages (from spikecomparison) (1.4.1)\n","Requirement already satisfied: joblib in /usr/local/lib/python3.7/dist-packages (from spikecomparison) (1.1.0)\n","Requirement already satisfied: spikeextractors>=0.9.7 in /usr/local/lib/python3.7/dist-packages (from spikecomparison) (0.9.9)\n","Requirement already satisfied: numpy in /usr/local/lib/python3.7/dist-packages (from spikecomparison) (1.19.5)\n","Requirement already satisfied: tqdm in /usr/local/lib/python3.7/dist-packages (from spikeextractors>=0.9.7->spikecomparison) (4.62.3)\n","Requirement already satisfied: requests in /usr/local/lib/python3.7/dist-packages (from spikesorters>=0.4.5->spikecomparison) (2.23.0)\n","Requirement already satisfied: spikemetrics>=0.2.4 in /usr/local/lib/python3.7/dist-packages (from spiketoolkit>=0.7.6->spikecomparison) (0.2.4)\n","Requirement already satisfied: spikefeatures in /usr/local/lib/python3.7/dist-packages (from spiketoolkit>=0.7.6->spikecomparison) (0.1.2)\n","Requirement already satisfied: scikit-learn in /usr/local/lib/python3.7/dist-packages (from spiketoolkit>=0.7.6->spikecomparison) (1.0.2)\n","Requirement already satisfied: pytz>=2017.3 in /usr/local/lib/python3.7/dist-packages (from pandas->spikecomparison) (2018.9)\n","Requirement already satisfied: python-dateutil>=2.7.3 in /usr/local/lib/python3.7/dist-packages (from pandas->spikecomparison) (2.8.2)\n","Requirement already satisfied: six>=1.5 in /usr/local/lib/python3.7/dist-packages (from python-dateutil>=2.7.3->pandas->spikecomparison) (1.15.0)\n","Requirement already satisfied: urllib3!=1.25.0,!=1.25.1,<1.26,>=1.21.1 in /usr/local/lib/python3.7/dist-packages (from requests->spikesorters>=0.4.5->spikecomparison) (1.24.3)\n","Requirement already satisfied: chardet<4,>=3.0.2 in /usr/local/lib/python3.7/dist-packages (from requests->spikesorters>=0.4.5->spikecomparison) (3.0.4)\n","Requirement already satisfied: certifi>=2017.4.17 in /usr/local/lib/python3.7/dist-packages (from requests->spikesorters>=0.4.5->spikecomparison) (2021.10.8)\n","Requirement already satisfied: idna<3,>=2.5 in /usr/local/lib/python3.7/dist-packages (from requests->spikesorters>=0.4.5->spikecomparison) (2.10)\n","Requirement already satisfied: threadpoolctl>=2.0.0 in /usr/local/lib/python3.7/dist-packages (from scikit-learn->spiketoolkit>=0.7.6->spikecomparison) (3.0.0)\n","Requirement already satisfied: spikemetrics in /usr/local/lib/python3.7/dist-packages (0.2.4)\n","Requirement already satisfied: numpy in /usr/local/lib/python3.7/dist-packages (from spikemetrics) (1.19.5)\n","Requirement already satisfied: scipy in /usr/local/lib/python3.7/dist-packages (from spikemetrics) (1.4.1)\n","Requirement already satisfied: scikit-learn in /usr/local/lib/python3.7/dist-packages (from spikemetrics) (1.0.2)\n","Requirement already satisfied: pandas in /usr/local/lib/python3.7/dist-packages (from spikemetrics) (1.3.5)\n","Requirement already satisfied: pytz>=2017.3 in /usr/local/lib/python3.7/dist-packages (from pandas->spikemetrics) (2018.9)\n","Requirement already satisfied: python-dateutil>=2.7.3 in /usr/local/lib/python3.7/dist-packages (from pandas->spikemetrics) (2.8.2)\n","Requirement already satisfied: six>=1.5 in /usr/local/lib/python3.7/dist-packages (from python-dateutil>=2.7.3->pandas->spikemetrics) (1.15.0)\n","Requirement already satisfied: threadpoolctl>=2.0.0 in /usr/local/lib/python3.7/dist-packages (from scikit-learn->spikemetrics) (3.0.0)\n","Requirement already satisfied: joblib>=0.11 in /usr/local/lib/python3.7/dist-packages (from scikit-learn->spikemetrics) (1.1.0)\n","Requirement already satisfied: MEAutility in /usr/local/lib/python3.7/dist-packages (1.5.0)\n","Requirement already satisfied: matplotlib in /usr/local/lib/python3.7/dist-packages (from MEAutility) (3.2.2)\n","Requirement already satisfied: numpy in /usr/local/lib/python3.7/dist-packages (from MEAutility) (1.19.5)\n","Requirement already satisfied: pyyaml in /usr/local/lib/python3.7/dist-packages (from MEAutility) (3.13)\n","Requirement already satisfied: python-dateutil>=2.1 in /usr/local/lib/python3.7/dist-packages (from matplotlib->MEAutility) (2.8.2)\n","Requirement already satisfied: kiwisolver>=1.0.1 in /usr/local/lib/python3.7/dist-packages (from matplotlib->MEAutility) (1.3.2)\n","Requirement already satisfied: pyparsing!=2.0.4,!=2.1.2,!=2.1.6,>=2.0.1 in /usr/local/lib/python3.7/dist-packages (from matplotlib->MEAutility) (3.0.7)\n","Requirement already satisfied: cycler>=0.10 in /usr/local/lib/python3.7/dist-packages (from matplotlib->MEAutility) (0.11.0)\n","Requirement already satisfied: six>=1.5 in /usr/local/lib/python3.7/dist-packages (from python-dateutil>=2.1->matplotlib->MEAutility) (1.15.0)\n","Requirement already satisfied: spikeinterface in /usr/local/lib/python3.7/dist-packages (0.92.0)\n","Requirement already satisfied: probeinterface>=0.2.3 in /usr/local/lib/python3.7/dist-packages (from spikeinterface) (0.2.6)\n","Requirement already satisfied: neo>=0.10.0 in /usr/local/lib/python3.7/dist-packages (from spikeinterface) (0.10.0)\n","Requirement already satisfied: numpy<1.21 in /usr/local/lib/python3.7/dist-packages (from spikeinterface) (1.19.5)\n","Requirement already satisfied: tqdm in /usr/local/lib/python3.7/dist-packages (from spikeinterface) (4.62.3)\n","Requirement already satisfied: joblib in /usr/local/lib/python3.7/dist-packages (from spikeinterface) (1.1.0)\n","Requirement already satisfied: quantities>=0.12.1 in /usr/local/lib/python3.7/dist-packages (from neo>=0.10.0->spikeinterface) (0.13.0)\n","Requirement already satisfied: ml_ms4alg in /usr/local/lib/python3.7/dist-packages (0.3.6)\n","Requirement already satisfied: spikeextractors>=0.4.1 in /usr/local/lib/python3.7/dist-packages (from ml_ms4alg) (0.9.9)\n","Requirement already satisfied: isosplit5 in /usr/local/lib/python3.7/dist-packages (from ml_ms4alg) (0.1.3)\n","Requirement already satisfied: mountainlab-pytools in /usr/local/lib/python3.7/dist-packages (from ml_ms4alg) (0.7.5)\n","Requirement already satisfied: numpy in /usr/local/lib/python3.7/dist-packages (from ml_ms4alg) (1.19.5)\n","Requirement already satisfied: dask in /usr/local/lib/python3.7/dist-packages (from ml_ms4alg) (2.12.0)\n","Requirement already satisfied: sklearn in /usr/local/lib/python3.7/dist-packages (from ml_ms4alg) (0.0)\n","Requirement already satisfied: pybind11 in /usr/local/lib/python3.7/dist-packages (from ml_ms4alg) (2.9.0)\n","Requirement already satisfied: h5py in /usr/local/lib/python3.7/dist-packages (from ml_ms4alg) (3.1.0)\n","Requirement already satisfied: tqdm in /usr/local/lib/python3.7/dist-packages (from spikeextractors>=0.4.1->ml_ms4alg) (4.62.3)\n","Requirement already satisfied: joblib in /usr/local/lib/python3.7/dist-packages (from spikeextractors>=0.4.1->ml_ms4alg) (1.1.0)\n","Requirement already satisfied: cached-property in /usr/local/lib/python3.7/dist-packages (from h5py->ml_ms4alg) (1.5.2)\n","Requirement already satisfied: requests in /usr/local/lib/python3.7/dist-packages (from mountainlab-pytools->ml_ms4alg) (2.23.0)\n","Requirement already satisfied: jp-proxy-widget in /usr/local/lib/python3.7/dist-packages (from mountainlab-pytools->ml_ms4alg) (1.0.10)\n","Requirement already satisfied: vdom in /usr/local/lib/python3.7/dist-packages (from mountainlab-pytools->ml_ms4alg) (0.6)\n","Requirement already satisfied: ipywidgets in /usr/local/lib/python3.7/dist-packages (from mountainlab-pytools->ml_ms4alg) (7.6.5)\n","Requirement already satisfied: ipython in /usr/local/lib/python3.7/dist-packages (from mountainlab-pytools->ml_ms4alg) (5.5.0)\n","Requirement already satisfied: numpydoc in /usr/local/lib/python3.7/dist-packages (from mountainlab-pytools->ml_ms4alg) (1.2)\n","Requirement already satisfied: pickleshare in /usr/local/lib/python3.7/dist-packages (from ipython->mountainlab-pytools->ml_ms4alg) (0.7.5)\n","Requirement already satisfied: pygments in /usr/local/lib/python3.7/dist-packages (from ipython->mountainlab-pytools->ml_ms4alg) (2.6.1)\n","Requirement already satisfied: prompt-toolkit<2.0.0,>=1.0.4 in /usr/local/lib/python3.7/dist-packages (from ipython->mountainlab-pytools->ml_ms4alg) (1.0.18)\n","Requirement already satisfied: simplegeneric>0.8 in /usr/local/lib/python3.7/dist-packages (from ipython->mountainlab-pytools->ml_ms4alg) (0.8.1)\n","Requirement already satisfied: traitlets>=4.2 in /usr/local/lib/python3.7/dist-packages (from ipython->mountainlab-pytools->ml_ms4alg) (5.1.1)\n","Requirement already satisfied: setuptools>=18.5 in /usr/local/lib/python3.7/dist-packages (from ipython->mountainlab-pytools->ml_ms4alg) (57.4.0)\n","Requirement already satisfied: pexpect in /usr/local/lib/python3.7/dist-packages (from ipython->mountainlab-pytools->ml_ms4alg) (4.8.0)\n","Requirement already satisfied: decorator in /usr/local/lib/python3.7/dist-packages (from ipython->mountainlab-pytools->ml_ms4alg) (4.4.2)\n","Requirement already satisfied: wcwidth in /usr/local/lib/python3.7/dist-packages (from prompt-toolkit<2.0.0,>=1.0.4->ipython->mountainlab-pytools->ml_ms4alg) (0.2.5)\n","Requirement already satisfied: six>=1.9.0 in /usr/local/lib/python3.7/dist-packages (from prompt-toolkit<2.0.0,>=1.0.4->ipython->mountainlab-pytools->ml_ms4alg) (1.15.0)\n","Requirement already satisfied: ipykernel>=4.5.1 in /usr/local/lib/python3.7/dist-packages (from ipywidgets->mountainlab-pytools->ml_ms4alg) (4.10.1)\n","Requirement already satisfied: nbformat>=4.2.0 in /usr/local/lib/python3.7/dist-packages (from ipywidgets->mountainlab-pytools->ml_ms4alg) (5.1.3)\n","Requirement already satisfied: jupyterlab-widgets>=1.0.0 in /usr/local/lib/python3.7/dist-packages (from ipywidgets->mountainlab-pytools->ml_ms4alg) (1.0.2)\n","Requirement already satisfied: widgetsnbextension~=3.5.0 in /usr/local/lib/python3.7/dist-packages (from ipywidgets->mountainlab-pytools->ml_ms4alg) (3.5.2)\n","Requirement already satisfied: ipython-genutils~=0.2.0 in /usr/local/lib/python3.7/dist-packages (from ipywidgets->mountainlab-pytools->ml_ms4alg) (0.2.0)\n","Requirement already satisfied: tornado>=4.0 in /usr/local/lib/python3.7/dist-packages (from ipykernel>=4.5.1->ipywidgets->mountainlab-pytools->ml_ms4alg) (5.1.1)\n","Requirement already satisfied: jupyter-client in /usr/local/lib/python3.7/dist-packages (from ipykernel>=4.5.1->ipywidgets->mountainlab-pytools->ml_ms4alg) (5.3.5)\n","Requirement already satisfied: jupyter-core in /usr/local/lib/python3.7/dist-packages (from nbformat>=4.2.0->ipywidgets->mountainlab-pytools->ml_ms4alg) (4.9.1)\n","Requirement already satisfied: jsonschema!=2.5.0,>=2.4 in /usr/local/lib/python3.7/dist-packages (from nbformat>=4.2.0->ipywidgets->mountainlab-pytools->ml_ms4alg) (4.3.3)\n","Requirement already satisfied: importlib-resources>=1.4.0 in /usr/local/lib/python3.7/dist-packages (from jsonschema!=2.5.0,>=2.4->nbformat>=4.2.0->ipywidgets->mountainlab-pytools->ml_ms4alg) (5.4.0)\n","Requirement already satisfied: importlib-metadata in /usr/local/lib/python3.7/dist-packages (from jsonschema!=2.5.0,>=2.4->nbformat>=4.2.0->ipywidgets->mountainlab-pytools->ml_ms4alg) (4.10.1)\n","Requirement already satisfied: typing-extensions in /usr/local/lib/python3.7/dist-packages (from jsonschema!=2.5.0,>=2.4->nbformat>=4.2.0->ipywidgets->mountainlab-pytools->ml_ms4alg) (3.10.0.2)\n","Requirement already satisfied: pyrsistent!=0.17.0,!=0.17.1,!=0.17.2,>=0.14.0 in /usr/local/lib/python3.7/dist-packages (from jsonschema!=2.5.0,>=2.4->nbformat>=4.2.0->ipywidgets->mountainlab-pytools->ml_ms4alg) (0.18.1)\n","Requirement already satisfied: attrs>=17.4.0 in /usr/local/lib/python3.7/dist-packages (from jsonschema!=2.5.0,>=2.4->nbformat>=4.2.0->ipywidgets->mountainlab-pytools->ml_ms4alg) (21.4.0)\n","Requirement already satisfied: zipp>=3.1.0 in /usr/local/lib/python3.7/dist-packages (from importlib-resources>=1.4.0->jsonschema!=2.5.0,>=2.4->nbformat>=4.2.0->ipywidgets->mountainlab-pytools->ml_ms4alg) (3.7.0)\n","Requirement already satisfied: notebook>=4.4.1 in /usr/local/lib/python3.7/dist-packages (from widgetsnbextension~=3.5.0->ipywidgets->mountainlab-pytools->ml_ms4alg) (5.3.1)\n","Requirement already satisfied: Send2Trash in /usr/local/lib/python3.7/dist-packages (from notebook>=4.4.1->widgetsnbextension~=3.5.0->ipywidgets->mountainlab-pytools->ml_ms4alg) (1.8.0)\n","Requirement already satisfied: jinja2 in /usr/local/lib/python3.7/dist-packages (from notebook>=4.4.1->widgetsnbextension~=3.5.0->ipywidgets->mountainlab-pytools->ml_ms4alg) (2.11.3)\n","Requirement already satisfied: terminado>=0.8.1 in /usr/local/lib/python3.7/dist-packages (from notebook>=4.4.1->widgetsnbextension~=3.5.0->ipywidgets->mountainlab-pytools->ml_ms4alg) (0.13.1)\n","Requirement already satisfied: nbconvert in /usr/local/lib/python3.7/dist-packages (from notebook>=4.4.1->widgetsnbextension~=3.5.0->ipywidgets->mountainlab-pytools->ml_ms4alg) (5.6.1)\n","Requirement already satisfied: python-dateutil>=2.1 in /usr/local/lib/python3.7/dist-packages (from jupyter-client->ipykernel>=4.5.1->ipywidgets->mountainlab-pytools->ml_ms4alg) (2.8.2)\n","Requirement already satisfied: pyzmq>=13 in /usr/local/lib/python3.7/dist-packages (from jupyter-client->ipykernel>=4.5.1->ipywidgets->mountainlab-pytools->ml_ms4alg) (22.3.0)\n","Requirement already satisfied: ptyprocess in /usr/local/lib/python3.7/dist-packages (from terminado>=0.8.1->notebook>=4.4.1->widgetsnbextension~=3.5.0->ipywidgets->mountainlab-pytools->ml_ms4alg) (0.7.0)\n","Requirement already satisfied: MarkupSafe>=0.23 in /usr/local/lib/python3.7/dist-packages (from jinja2->notebook>=4.4.1->widgetsnbextension~=3.5.0->ipywidgets->mountainlab-pytools->ml_ms4alg) (2.0.1)\n","Requirement already satisfied: jupyter-ui-poll in /usr/local/lib/python3.7/dist-packages (from jp-proxy-widget->mountainlab-pytools->ml_ms4alg) (0.2.1)\n","Requirement already satisfied: testpath in /usr/local/lib/python3.7/dist-packages (from nbconvert->notebook>=4.4.1->widgetsnbextension~=3.5.0->ipywidgets->mountainlab-pytools->ml_ms4alg) (0.5.0)\n","Requirement already satisfied: pandocfilters>=1.4.1 in /usr/local/lib/python3.7/dist-packages (from nbconvert->notebook>=4.4.1->widgetsnbextension~=3.5.0->ipywidgets->mountainlab-pytools->ml_ms4alg) (1.5.0)\n","Requirement already satisfied: defusedxml in /usr/local/lib/python3.7/dist-packages (from nbconvert->notebook>=4.4.1->widgetsnbextension~=3.5.0->ipywidgets->mountainlab-pytools->ml_ms4alg) (0.7.1)\n","Requirement already satisfied: bleach in /usr/local/lib/python3.7/dist-packages (from nbconvert->notebook>=4.4.1->widgetsnbextension~=3.5.0->ipywidgets->mountainlab-pytools->ml_ms4alg) (4.1.0)\n","Requirement already satisfied: entrypoints>=0.2.2 in /usr/local/lib/python3.7/dist-packages (from nbconvert->notebook>=4.4.1->widgetsnbextension~=3.5.0->ipywidgets->mountainlab-pytools->ml_ms4alg) (0.3)\n","Requirement already satisfied: mistune<2,>=0.8.1 in /usr/local/lib/python3.7/dist-packages (from nbconvert->notebook>=4.4.1->widgetsnbextension~=3.5.0->ipywidgets->mountainlab-pytools->ml_ms4alg) (0.8.4)\n","Requirement already satisfied: packaging in /usr/local/lib/python3.7/dist-packages (from bleach->nbconvert->notebook>=4.4.1->widgetsnbextension~=3.5.0->ipywidgets->mountainlab-pytools->ml_ms4alg) (21.3)\n","Requirement already satisfied: webencodings in /usr/local/lib/python3.7/dist-packages (from bleach->nbconvert->notebook>=4.4.1->widgetsnbextension~=3.5.0->ipywidgets->mountainlab-pytools->ml_ms4alg) (0.5.1)\n","Requirement already satisfied: sphinx>=1.8 in /usr/local/lib/python3.7/dist-packages (from numpydoc->mountainlab-pytools->ml_ms4alg) (1.8.6)\n","Requirement already satisfied: snowballstemmer>=1.1 in /usr/local/lib/python3.7/dist-packages (from sphinx>=1.8->numpydoc->mountainlab-pytools->ml_ms4alg) (2.2.0)\n","Requirement already satisfied: docutils<0.18,>=0.11 in /usr/local/lib/python3.7/dist-packages (from sphinx>=1.8->numpydoc->mountainlab-pytools->ml_ms4alg) (0.17.1)\n","Requirement already satisfied: alabaster<0.8,>=0.7 in /usr/local/lib/python3.7/dist-packages (from sphinx>=1.8->numpydoc->mountainlab-pytools->ml_ms4alg) (0.7.12)\n","Requirement already satisfied: babel!=2.0,>=1.3 in /usr/local/lib/python3.7/dist-packages (from sphinx>=1.8->numpydoc->mountainlab-pytools->ml_ms4alg) (2.9.1)\n","Requirement already satisfied: imagesize in /usr/local/lib/python3.7/dist-packages (from sphinx>=1.8->numpydoc->mountainlab-pytools->ml_ms4alg) (1.3.0)\n","Requirement already satisfied: sphinxcontrib-websupport in /usr/local/lib/python3.7/dist-packages (from sphinx>=1.8->numpydoc->mountainlab-pytools->ml_ms4alg) (1.2.4)\n","Requirement already satisfied: pytz>=2015.7 in /usr/local/lib/python3.7/dist-packages (from babel!=2.0,>=1.3->sphinx>=1.8->numpydoc->mountainlab-pytools->ml_ms4alg) (2018.9)\n","Requirement already satisfied: idna<3,>=2.5 in /usr/local/lib/python3.7/dist-packages (from requests->mountainlab-pytools->ml_ms4alg) (2.10)\n","Requirement already satisfied: chardet<4,>=3.0.2 in /usr/local/lib/python3.7/dist-packages (from requests->mountainlab-pytools->ml_ms4alg) (3.0.4)\n","Requirement already satisfied: urllib3!=1.25.0,!=1.25.1,<1.26,>=1.21.1 in /usr/local/lib/python3.7/dist-packages (from requests->mountainlab-pytools->ml_ms4alg) (1.24.3)\n","Requirement already satisfied: certifi>=2017.4.17 in /usr/local/lib/python3.7/dist-packages (from requests->mountainlab-pytools->ml_ms4alg) (2021.10.8)\n","Requirement already satisfied: pyparsing!=3.0.5,>=2.0.2 in /usr/local/lib/python3.7/dist-packages (from packaging->bleach->nbconvert->notebook>=4.4.1->widgetsnbextension~=3.5.0->ipywidgets->mountainlab-pytools->ml_ms4alg) (3.0.7)\n","Requirement already satisfied: scikit-learn in /usr/local/lib/python3.7/dist-packages (from sklearn->ml_ms4alg) (1.0.2)\n","Requirement already satisfied: threadpoolctl>=2.0.0 in /usr/local/lib/python3.7/dist-packages (from scikit-learn->sklearn->ml_ms4alg) (3.0.0)\n","Requirement already satisfied: scipy>=1.1.0 in /usr/local/lib/python3.7/dist-packages (from scikit-learn->sklearn->ml_ms4alg) (1.4.1)\n","Requirement already satisfied: sphinxcontrib-serializinghtml in /usr/local/lib/python3.7/dist-packages (from sphinxcontrib-websupport->sphinx>=1.8->numpydoc->mountainlab-pytools->ml_ms4alg) (1.1.5)\n","Requirement already satisfied: mountainsort4 in /usr/local/lib/python3.7/dist-packages (1.0.0)\n","Requirement already satisfied: isosplit5==0.1.3 in /usr/local/lib/python3.7/dist-packages (from mountainsort4) (0.1.3)\n","Requirement already satisfied: numpy in /usr/local/lib/python3.7/dist-packages (from mountainsort4) (1.19.5)\n","Requirement already satisfied: spikeextractors>=0.9.5 in /usr/local/lib/python3.7/dist-packages (from mountainsort4) (0.9.9)\n","Requirement already satisfied: h5py in /usr/local/lib/python3.7/dist-packages (from mountainsort4) (3.1.0)\n","Requirement already satisfied: dask in /usr/local/lib/python3.7/dist-packages (from mountainsort4) (2.12.0)\n","Requirement already satisfied: pybind11 in /usr/local/lib/python3.7/dist-packages (from mountainsort4) (2.9.0)\n","Requirement already satisfied: sklearn in /usr/local/lib/python3.7/dist-packages (from mountainsort4) (0.0)\n","Requirement already satisfied: joblib in /usr/local/lib/python3.7/dist-packages (from spikeextractors>=0.9.5->mountainsort4) (1.1.0)\n","Requirement already satisfied: tqdm in /usr/local/lib/python3.7/dist-packages (from spikeextractors>=0.9.5->mountainsort4) (4.62.3)\n","Requirement already satisfied: cached-property in /usr/local/lib/python3.7/dist-packages (from h5py->mountainsort4) (1.5.2)\n","Requirement already satisfied: scikit-learn in /usr/local/lib/python3.7/dist-packages (from sklearn->mountainsort4) (1.0.2)\n","Requirement already satisfied: scipy>=1.1.0 in /usr/local/lib/python3.7/dist-packages (from scikit-learn->sklearn->mountainsort4) (1.4.1)\n","Requirement already satisfied: threadpoolctl>=2.0.0 in /usr/local/lib/python3.7/dist-packages (from scikit-learn->sklearn->mountainsort4) (3.0.0)\n"]}],"source":["### old mountainsort version\n","'''\n","!pip install spiketoolkit==0.6.3\n","!pip install spikewidgets==0.4.3\n","!pip install spikeextractors==0.8.4\n","!pip install spikesorters==0.3.2\n","!pip install spikecomparison==0.2.6\n","!pip install spikemetrics==0.2.0\n","!pip install MEAutility==1.4.6\n","!pip install spikeinterface==0.9.9\n","!pip install ml_ms4alg\n","'''\n","### new mountainsort version\n","\n","# !pip uninstall spiketoolkit\n","# !pip uninstall spikewidgets\n","# !pip uninstall spikeextractors\n","# !pip uninstall spikesorters\n","# !pip uninstall spikecomparison\n","# !pip uninstall spikemetrics\n","# !pip uninstall MEAutility\n","# !pip uninstall spikeinterface\n","# !pip uninstall ml_ms4alg\n","\n","!pip install openpyxl==3.0.9\n","!pip install spiketoolkit\n","!pip install spikewidgets\n","!pip install spikeextractors\n","!pip install spikesorters\n","!pip install spikecomparison\n","!pip install spikemetrics\n","!pip install MEAutility\n","!pip install spikeinterface\n","!pip install ml_ms4alg\n","\n","#!pip freeze > requirements2.txt\n","#!pip install -r requirements2.txt\n","\n","!pip install mountainsort4\n","\n","# import spikeinterface as si\n","import spikeinterface.extractors as se\n","import spikeinterface.toolkit as st\n","import spikeinterface.sorters as ss\n","import spikeinterface.comparison as sc\n","import spikeinterface.widgets as sw\n","\n","import numpy as np\n","import matplotlib.pylab as plt\n","import matplotlib.image as mpimg\n","import pandas as pd\n","import scipy.io\n","from matplotlib import cm\n","import os\n","import sys"]},{"cell_type":"code","execution_count":null,"metadata":{"id":"EQevAzwf1isD"},"outputs":[],"source":["#setup to import our own custom libraries\n","import sys\n","libdir = \"/content/drive/MyDrive/EPhys Recordings/lib/\" #yuhaolib/lib\"\n","sys.path.insert(1, libdir)\n","\n","# this is how we can import our own libraries\n","from jaylib.histogram import plot_firing_rate\n","from jaylib.accumulate import plot_cumulative_spikes\n","\n","# dynamically re-imports module\n","import importlib\n","estherlib_mods = [m for m in sys.modules.keys() if 'esther' in m]\n","for m in estherlib_mods:\n","  importlib.reload(sys.modules[m])\n","  \n","yuhaolib_mods = [m for m in sys.modules.keys() if 'yuhao' in m]\n","for m in yuhaolib_mods:\n","  importlib.reload(sys.modules[m])\n","\n","# new ms4\n","from yuhaolib.datasetObjectModule import *\n","\n","# old ms4\n","# from estherlib.datasetObjectModule import *\n","\n","from estherlib.uniform_60_filtering import uniform_60_filt\n","from estherlib.returnDataInfo import *\n","from estherlib.cachingModule import *\n","#from estherlib.runRoutines import *\n","\n","from stellalib.custom_raster import custom_raster\n","from madilib.waveform_viewer import waveform_subplot\n"]},{"cell_type":"code","execution_count":null,"metadata":{"id":"3uigERwP1O77"},"outputs":[],"source":["import spikeinterface.core as si\n","import spikeinterface.extractors as se\n","import spikeinterface.toolkit as st\n","import spikeinterface.sorters as ss\n","import spikeinterface.comparison as sc\n","import spikeinterface.widgets as sw\n","\n","import numpy as np\n","import matplotlib.pylab as plt\n","import matplotlib.image as mpimg\n","import pandas as pd\n","import scipy.io\n","from matplotlib import cm\n","import os\n","import copy\n","import gc"]},{"cell_type":"markdown","metadata":{"id":"AMljocnN800R"},"source":["# Interactive Running and Plotting"]},{"cell_type":"markdown","metadata":{"id":"zRjlSzOAED_P"},"source":["Easy Access to Visualizations\n","\n","Will dynamically reload"]},{"cell_type":"code","execution_count":null,"metadata":{"colab":{"background_save":true,"base_uri":"https://localhost:8080/","height":849},"executionInfo":{"elapsed":81594,"status":"error","timestamp":1643758696975,"user":{"displayName":"Jay Reddy","photoUrl":"https://lh3.googleusercontent.com/a-/AOh14Gi6JEyxGNu8cAXlWGf5Y-I1bMTb0Q8xKMo-PB10FA=s64","userId":"04816875594114725413"},"user_tz":300},"id":"Mb9okroz1leg","outputId":"66eca22a-fa85-411a-b80d-532a568f64df"},"outputs":[{"name":"stdout","output_type":"stream","text":["initializing dataset...\n","self.originalChanNum 49.0\n","Calculating recording_cmr...\n","Loaded Dataset: Jay ReaCh In Vivo-NEW\n","searching for /content/drive/My Drive/EPhys Recordings/Chamanzar Lab Recording/Yuhao/cache_test/cache_with_probe_sample_prominence100/\n","Filtered data FOUND IN CACHE: /content/drive/My Drive/EPhys Recordings/Chamanzar Lab Recording/Yuhao/cache_test/cache_with_probe_sample_prominence100/filtered Jay ReaCh In Vivo-NEW data with 100 spike prominence.RAW\n","Filtered data array shape (49, 10949760)\n"]},{"ename":"AttributeError","evalue":"ignored","output_type":"error","traceback":["\u001b[0;31m---------------------------------------------------------------------------\u001b[0m","\u001b[0;31mAttributeError\u001b[0m                            Traceback (most recent call last)","\u001b[0;32m<ipython-input-6-d48838d38d17>\u001b[0m in \u001b[0;36m<module>\u001b[0;34m()\u001b[0m\n\u001b[1;32m     13\u001b[0m \u001b[0;31m## Data automatically generated or pulled from cache to create visualizations\u001b[0m\u001b[0;34m\u001b[0m\u001b[0;34m\u001b[0m\u001b[0;34m\u001b[0m\u001b[0m\n\u001b[1;32m     14\u001b[0m \u001b[0;31m# dataObj.loadMountainSort(overide = False)\u001b[0m\u001b[0;34m\u001b[0m\u001b[0;34m\u001b[0m\u001b[0;34m\u001b[0m\u001b[0m\n\u001b[0;32m---> 15\u001b[0;31m \u001b[0mdataObj\u001b[0m\u001b[0;34m.\u001b[0m\u001b[0mloadMountainSort\u001b[0m\u001b[0;34m(\u001b[0m\u001b[0moveride\u001b[0m \u001b[0;34m=\u001b[0m \u001b[0;32mTrue\u001b[0m\u001b[0;34m)\u001b[0m\u001b[0;34m\u001b[0m\u001b[0;34m\u001b[0m\u001b[0m\n\u001b[0m\u001b[1;32m     16\u001b[0m \u001b[0;31m# %debug dataObj.loadMountainSort(overide = True)\u001b[0m\u001b[0;34m\u001b[0m\u001b[0;34m\u001b[0m\u001b[0;34m\u001b[0m\u001b[0m\n\u001b[1;32m     17\u001b[0m \u001b[0;31m# %debug dataObj.loadMountainSort(overide = False)\u001b[0m\u001b[0;34m\u001b[0m\u001b[0;34m\u001b[0m\u001b[0;34m\u001b[0m\u001b[0m\n","\u001b[0;32m/content/drive/MyDrive/EPhys Recordings/lib/yuhaolib/datasetObjectModule.py\u001b[0m in \u001b[0;36mloadMountainSort\u001b[0;34m(self, saveOnly, overide)\u001b[0m\n\u001b[1;32m    241\u001b[0m             \u001b[0mms4_params\u001b[0m\u001b[0;34m[\u001b[0m\u001b[0;34m'detect_sign'\u001b[0m\u001b[0;34m]\u001b[0m \u001b[0;34m=\u001b[0m \u001b[0mself\u001b[0m\u001b[0;34m.\u001b[0m\u001b[0mdetect_sign\u001b[0m\u001b[0;34m\u001b[0m\u001b[0;34m\u001b[0m\u001b[0m\n\u001b[1;32m    242\u001b[0m             \u001b[0;32mif\u001b[0m \u001b[0mself\u001b[0m\u001b[0;34m.\u001b[0m\u001b[0mrecording_cmr\u001b[0m \u001b[0;32mis\u001b[0m \u001b[0;32mNone\u001b[0m\u001b[0;34m:\u001b[0m\u001b[0;34m\u001b[0m\u001b[0;34m\u001b[0m\u001b[0m\n\u001b[0;32m--> 243\u001b[0;31m                 \u001b[0mself\u001b[0m\u001b[0;34m.\u001b[0m\u001b[0mderiveRecordingData\u001b[0m\u001b[0;34m(\u001b[0m\u001b[0;34m)\u001b[0m\u001b[0;34m\u001b[0m\u001b[0;34m\u001b[0m\u001b[0m\n\u001b[0m\u001b[1;32m    244\u001b[0m                 \u001b[0;31m#self.saveRecordingCMR() removed 1-28 b/c saveRecordingCMR is now called inside deriveRecordingData\u001b[0m\u001b[0;34m\u001b[0m\u001b[0;34m\u001b[0m\u001b[0;34m\u001b[0m\u001b[0m\n\u001b[1;32m    245\u001b[0m \u001b[0;34m\u001b[0m\u001b[0m\n","\u001b[0;32m/content/drive/MyDrive/EPhys Recordings/lib/yuhaolib/datasetObjectModule.py\u001b[0m in \u001b[0;36mderiveRecordingData\u001b[0;34m(self)\u001b[0m\n\u001b[1;32m    127\u001b[0m \u001b[0;34m\u001b[0m\u001b[0m\n\u001b[1;32m    128\u001b[0m         \u001b[0;31m# instantiate recording object\u001b[0m\u001b[0;34m\u001b[0m\u001b[0;34m\u001b[0m\u001b[0;34m\u001b[0m\u001b[0m\n\u001b[0;32m--> 129\u001b[0;31m         \u001b[0mse\u001b[0m\u001b[0;34m.\u001b[0m\u001b[0mBinaryRecordingExtractor\u001b[0m\u001b[0;34m.\u001b[0m\u001b[0mwrite_recording\u001b[0m\u001b[0;34m(\u001b[0m\u001b[0mself\u001b[0m\u001b[0;34m.\u001b[0m\u001b[0mdata\u001b[0m\u001b[0;34m,\u001b[0m \u001b[0mself\u001b[0m\u001b[0;34m.\u001b[0m\u001b[0mcacheFilePath\u001b[0m \u001b[0;34m+\u001b[0m \u001b[0;34m\"/cached_seg0.raw\"\u001b[0m\u001b[0;34m)\u001b[0m\u001b[0;34m\u001b[0m\u001b[0;34m\u001b[0m\u001b[0m\n\u001b[0m\u001b[1;32m    130\u001b[0m         \u001b[0;31m# self.recording = si.NumpyRecording(traces_list = self.data.T, sampling_frequency = float(self.samplingFrequency))\u001b[0m\u001b[0;34m\u001b[0m\u001b[0;34m\u001b[0m\u001b[0;34m\u001b[0m\u001b[0m\n\u001b[1;32m    131\u001b[0m         \u001b[0mself\u001b[0m\u001b[0;34m.\u001b[0m\u001b[0mrecording\u001b[0m \u001b[0;34m=\u001b[0m \u001b[0mse\u001b[0m\u001b[0;34m.\u001b[0m\u001b[0mBinaryRecordingExtractor\u001b[0m\u001b[0;34m(\u001b[0m\u001b[0mself\u001b[0m\u001b[0;34m.\u001b[0m\u001b[0mcacheFilePath\u001b[0m \u001b[0;34m+\u001b[0m \u001b[0;34m\"/cached_seg0.raw\"\u001b[0m\u001b[0;34m,\u001b[0m \u001b[0mfloat\u001b[0m\u001b[0;34m(\u001b[0m\u001b[0mself\u001b[0m\u001b[0;34m.\u001b[0m\u001b[0msamplingFrequency\u001b[0m\u001b[0;34m)\u001b[0m\u001b[0;34m,\u001b[0m \u001b[0mself\u001b[0m\u001b[0;34m.\u001b[0m\u001b[0moriginalChanNum\u001b[0m\u001b[0;34m,\u001b[0m \u001b[0mself\u001b[0m\u001b[0;34m.\u001b[0m\u001b[0mdata\u001b[0m\u001b[0;34m.\u001b[0m\u001b[0mdtype\u001b[0m\u001b[0;34m)\u001b[0m\u001b[0;34m\u001b[0m\u001b[0;34m\u001b[0m\u001b[0m\n","\u001b[0;32m/usr/local/lib/python3.7/dist-packages/spikeinterface/core/binaryrecordingextractor.py\u001b[0m in \u001b[0;36mwrite_recording\u001b[0;34m(recording, file_paths, dtype, **job_kwargs)\u001b[0m\n\u001b[1;32m    117\u001b[0m         \u001b[0;34m{\u001b[0m\u001b[0;34m}\u001b[0m\u001b[0;34m\u001b[0m\u001b[0;34m\u001b[0m\u001b[0m\n\u001b[1;32m    118\u001b[0m         \"\"\"\n\u001b[0;32m--> 119\u001b[0;31m         \u001b[0mwrite_binary_recording\u001b[0m\u001b[0;34m(\u001b[0m\u001b[0mrecording\u001b[0m\u001b[0;34m,\u001b[0m \u001b[0mfile_paths\u001b[0m\u001b[0;34m=\u001b[0m\u001b[0mfile_paths\u001b[0m\u001b[0;34m,\u001b[0m \u001b[0mdtype\u001b[0m\u001b[0;34m=\u001b[0m\u001b[0mdtype\u001b[0m\u001b[0;34m,\u001b[0m \u001b[0;34m**\u001b[0m\u001b[0mjob_kwargs\u001b[0m\u001b[0;34m)\u001b[0m\u001b[0;34m\u001b[0m\u001b[0;34m\u001b[0m\u001b[0m\n\u001b[0m\u001b[1;32m    120\u001b[0m \u001b[0;34m\u001b[0m\u001b[0m\n\u001b[1;32m    121\u001b[0m \u001b[0;34m\u001b[0m\u001b[0m\n","\u001b[0;32m/usr/local/lib/python3.7/dist-packages/spikeinterface/core/core_tools.py\u001b[0m in \u001b[0;36mwrite_binary_recording\u001b[0;34m(recording, file_paths, dtype, add_file_extension, verbose, byte_offset, **job_kwargs)\u001b[0m\n\u001b[1;32m    214\u001b[0m \u001b[0;34m\u001b[0m\u001b[0m\n\u001b[1;32m    215\u001b[0m     \u001b[0;32mif\u001b[0m \u001b[0mdtype\u001b[0m \u001b[0;32mis\u001b[0m \u001b[0;32mNone\u001b[0m\u001b[0;34m:\u001b[0m\u001b[0;34m\u001b[0m\u001b[0;34m\u001b[0m\u001b[0m\n\u001b[0;32m--> 216\u001b[0;31m         \u001b[0mdtype\u001b[0m \u001b[0;34m=\u001b[0m \u001b[0mrecording\u001b[0m\u001b[0;34m.\u001b[0m\u001b[0mget_dtype\u001b[0m\u001b[0;34m(\u001b[0m\u001b[0;34m)\u001b[0m\u001b[0;34m\u001b[0m\u001b[0;34m\u001b[0m\u001b[0m\n\u001b[0m\u001b[1;32m    217\u001b[0m \u001b[0;34m\u001b[0m\u001b[0m\n\u001b[1;32m    218\u001b[0m     \u001b[0;31m# create memmap files\u001b[0m\u001b[0;34m\u001b[0m\u001b[0;34m\u001b[0m\u001b[0;34m\u001b[0m\u001b[0m\n","\u001b[0;31mAttributeError\u001b[0m: 'numpy.ndarray' object has no attribute 'get_dtype'"]}],"source":["\n","## User needs to define three variables\n","dataInd = 57\n","spikeProminence = 100# 0.3 #0.1\n","sortingThreshold = 5\n","bandpassLow = 500\n","bandpassHigh = 5000\n","display = True\n","filedir = \"/content/drive/My Drive/EPhys Recordings/lib/yuhaolib/chamLabRecordingVariables.xlsx\"\n","\n","dataObj = Dataset(filedir, dataInd, spikeProminence, sortingThreshold, bandpassLow, bandpassHigh,detect_sign=0, display = display) # create data object\n","\n","## Data automatically generated or pulled from cache to create visualizations\n","dataObj.loadMountainSort(overide = True)\n","dataObj.loadVariables(overide = True)\n","\n","  # # # set overide = True to regenerate and save without pulling from cache (default is False)\n","  # # # set version to original for all analysis\n","#dataObj.visualize(\"waveforms\", version = \"original\", overide = True) #unit wavesforms\n","  # dataObj.visualize(\"raster\", version = \"original\", overide = True) #raster plots\n","  # dataObj.visualize(\"indvHisto\", version = \"original\", overide = True, timeRange = None, binsize = 2) #firing-rate histogram of each unit separately, binsize refers to width of histogram bin\n","#dataObj.visualize(\"overlaidHisto\", version = \"original\", overide = True, binsize = 2) #overlapping histogram of firing-rate histogramas\n","#dataObj.visualize(\"isi\", version = \"original\", overide = True, binsize = 30) #interspike interval plots, binsize actually referns to number of bins\n"]},{"cell_type":"code","execution_count":null,"metadata":{"id":"QaEuKBX4-bDO"},"outputs":[],"source":["# units_to_plot = [1,2,3,4,5,6,7,8,9,11,12,13,14,15,16,18,25,27,28,30,31,32,36,42,43,44,46,47,48,49,50,51,52,53,54,55]\n","units_to_plot = [1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21]\n","\n","\n","dataObj.visualize(\"isi\", version = \"original\", overide = True, binsize = 30)"]},{"cell_type":"code","execution_count":null,"metadata":{"id":"DeWnOwdDesSV"},"outputs":[],"source":["# sw.plot_unit_waveforms(sorting=dataObj.sorting_MS4, \n","#                               recording=dataObj.recording,\n","#                               unit_ids=[1,2,3], \n","#                               max_spikes_per_unit=100)\n","\n","from spikeinterface import extract_waveforms\n","folder = '/content/drive/My Drive/spike_latest/waveform_folder'\n","we = extract_waveforms(dataObj.recording, dataObj.sorting_MS4, folder, max_spikes_per_unit=100, load_if_exists=True)\n","# sw.plot_unit_waveforms(waveform_extractor=dataObj.sorting_MS4, \n","#                               recording=dataObj.recording,\n","#                               unit_ids=[1,2,3], \n","#                               max_spikes_per_unit=100)\n","sw.plot_unit_waveforms(we, unit_ids=[1,2,3])"]},{"cell_type":"code","execution_count":null,"metadata":{"id":"Pf7PfhCQmEBl"},"outputs":[],"source":["for spikes in dataObj.spikes2:\n","  print(len(spikes))\n","\n","goodunits= []\n","for ind in [ind for ind, unitspikes in enumerate(dataObj.spikes2) if ind+1 in units_to_plot and len(unitspikes)> 200]:\n","  goodunits.append(ind+1)\n","\n","goodunits"]},{"cell_type":"code","execution_count":null,"metadata":{"id":"Vk8g5t64udS1"},"outputs":[],"source":["import ipywidgets as widgets\n","from ipywidgets import interact\n","from IPython.display import display\n","from mpl_toolkits.axes_grid1.anchored_artists import AnchoredSizeBar\n","from matplotlib.offsetbox import AnchoredOffsetbox\n","\n","class AnchoredScaleBar(AnchoredOffsetbox):\n","    def __init__(self, transform, sizex=0, sizey=0, labelx=None, labely=None, loc=4,\n","                 pad=0.1, borderpad=0.1, sep=2, prop=None, barcolor=\"black\", barwidth=None, \n","                 **kwargs):\n","        \"\"\"\n","        Draw a horizontal and/or vertical  bar with the size in data coordinate\n","        of the give axes. A label will be drawn underneath (center-aligned).\n","        - transform : the coordinate frame (typically axes.transData)\n","        - sizex,sizey : width of x,y bar, in data units. 0 to omit\n","        - labelx,labely : labels for x,y bars; None to omit\n","        - loc : position in containing axes\n","        - pad, borderpad : padding, in fraction of the legend font size (or prop)\n","        - sep : separation between labels and bars in points.\n","        - **kwargs : additional arguments passed to base class constructor\n","        \"\"\"\n","        from matplotlib.patches import Rectangle\n","        from matplotlib.offsetbox import AuxTransformBox, VPacker, HPacker, TextArea, DrawingArea\n","        bars = AuxTransformBox(transform)\n","        if sizex:\n","            bars.add_artist(Rectangle((0,0), sizex, 0, ec=barcolor, lw=barwidth, fc=\"none\"))\n","        if sizey:\n","            bars.add_artist(Rectangle((0,0), 0, sizey, ec=barcolor, lw=barwidth, fc=\"none\"))\n","\n","        if sizex and labelx:\n","            self.xlabel = TextArea(labelx, minimumdescent=False)\n","            bars = VPacker(children=[bars, self.xlabel], align=\"center\", pad=0, sep=sep)\n","        if sizey and labely:\n","            self.ylabel = TextArea(labely)\n","            bars = HPacker(children=[self.ylabel, bars], align=\"center\", pad=0, sep=sep)\n","\n","        AnchoredOffsetbox.__init__(self, loc, pad=pad, borderpad=borderpad,\n","                                   child=bars, prop=prop, frameon=True, **kwargs)\n","\n","        \n","def add_scalebar(ax, matchx=True, matchy=True, hidex=True, hidey=True, **kwargs):\n","    \"\"\" Add scalebars to axes\n","    Adds a set of scale bars to *ax*, matching the size to the ticks of the plot\n","    and optionally hiding the x and y axes\n","    - ax : the axis to attach ticks to\n","    - matchx,matchy : if True, set size of scale bars to spacing between ticks\n","                    if False, size should be set using sizex and sizey params\n","    - hidex,hidey : if True, hide x-axis and y-axis of parent\n","    - **kwargs : additional arguments passed to AnchoredScaleBars\n","    Returns created scalebar object\n","    \"\"\"\n","    def f(axis):\n","        l = axis.get_majorticklocs()\n","        return len(l)>1 and (l[1] - l[0])\n","    \n","    if matchx:\n","        kwargs['sizex'] = f(ax.xaxis)\n","        kwargs['labelx'] = str(kwargs['sizex'])\n","    if matchy:\n","        kwargs['sizey'] = f(ax.yaxis)\n","        kwargs['labely'] = str(kwargs['sizey'])\n","        \n","    sb = AnchoredScaleBar(ax.transData, **kwargs)\n","    ax.add_artist(sb)\n","\n","    if hidex : ax.xaxis.set_visible(False)\n","    if hidey : ax.yaxis.set_visible(False)\n","    if hidex and hidey: ax.set_frame_on(False)\n","\n","    return sb\n","\n","def f(unit, event, ms_buffer):\n","  t0 = dataObj.spikes2[unit-1][event]\n","  t0 = t0/dataObj.samplingFrequency\n","  offset = ms_buffer/1000\n","  # fig = sw.plot_timeseries(dataObj.recording, trange= [t0-offset, t0+offset])\n","  fig = sw.plot_timeseries(dataObj.recording, time_range= [t0-offset, t0+offset])\n","\n","  ax = fig.ax\n","  add_scalebar(ax,\n","               False, \n","               False, \n","               hidex=False, \n","               hidey=False, \n","               sizex= 0.005,\n","               sizey=100, \n","               labelx='5 ms', \n","               labely='100 uV')\n","  ax.set_xticks([t0])\n","  ax.ticklabel_format(style = 'plain', useOffset = False)\n","  \n","\n","\n","unit_widget = widgets.Dropdown(options = dataObj.units, value = 1)\n","\n","max_events =len(dataObj.spikes2[unit_widget.value -1]) -1\n","event_widget = widgets.IntSlider(min=0,max = max_events)\n","buffer_widget = widgets.IntSlider(min=1,max = 50, value = 10)\n","\n","def update_event_range(*args):\n","    event_widget.max = len(dataObj.spikes2[unit_widget.value -1]) -1\n","\n","unit_widget.observe(update_event_range, 'value')\n","\n","interact(f, unit = unit_widget, event =event_widget, ms_buffer = buffer_widget)\n"]},{"cell_type":"code","execution_count":null,"metadata":{"id":"AyH7nUoGK433"},"outputs":[],"source":["def f(units, event):\n","  fig =sw.plot_unit_waveforms(sorting=dataObj.sorting_MS4, \n","                              recording=dataObj.recording,\n","                              unit_ids=units, \n","                              max_spikes_per_unit=event)\n","  #ax = fig.ax\n","  # add_scalebar(ax,\n","  #              False, \n","  #              False, \n","  #              hidex=False, \n","  #              hidey=False, \n","  #              sizex= 1,\n","  #              sizey=1, \n","  #              labelx='5 ms', \n","  #              labely='100 uV')\n","  #ax.set_xticks([t0])\n","  #ax.ticklabel_format(style = 'plain', useOffset = False)\n","\n","\n","units_widget = widgets.SelectMultiple(options = dataObj.units, value = [1,2])\n","\n","max_events =len(dataObj.spikes2[unit_widget.value -1])\n","event_widget = widgets.IntSlider(min=1,max = max_events, value = 10)\n","\n","def update_event_range(*args):\n","    event_widget.max = len(dataObj.spikes2[unit_widget.value -1]) \n","unit_widget.observe(update_event_range, 'value')\n","\n","interact(f, units = units_widget, event =event_widget, continuous_update=False)"]},{"cell_type":"code","execution_count":null,"metadata":{"id":"053gONKcoPwz"},"outputs":[],"source":["sw.plot_unit_waveforms(sorting=dataObj.sorting_MS4, \n","                              recording=dataObj.recording,\n","                              unit_ids=[1,2,3], \n","                              max_spikes_per_unit=100, plot_channels= True)"]},{"cell_type":"code","execution_count":null,"metadata":{"id":"1ubpab3UpixU"},"outputs":[],"source":["for u in units_to_plot:\n","  plot = sw.plot_unit_templates(sorting=dataObj.sorting_MS4, \n","                              recording=dataObj.recording,\n","                              unit_ids=[u], \n","                              max_spikes_per_unit=50, plot_channels= False, ms_before = 1, ms_after = 2)\n","  fig = plot.figure\n","  fig.savefig(f'waveform_{u}.jpg', dpi=1200)"]},{"cell_type":"code","execution_count":null,"metadata":{"id":"d96uxGcmE6Lz"},"outputs":[],"source":["dataObj.visualize(\"raster\", version = \"original\", overide = True, binsize = 30)"]},{"cell_type":"code","execution_count":null,"metadata":{"id":"MsfyYWdEd8io"},"outputs":[],"source":["dataObj.visualize(\"waveforms\", version = \"original\", overide = True)"]}],"metadata":{"accelerator":"TPU","colab":{"collapsed_sections":[],"machine_shape":"hm","name":"Spike-sorting latest","provenance":[{"file_id":"1Rc6aEenpYTKJ-ZegyymMsTz6ppB1KYqx","timestamp":1619747835035},{"file_id":"1odn0evkKOB8H2we_YFuDySnawT7oEKT2","timestamp":1611875922898},{"file_id":"1pwGbfh3JucUzh08Iv4wK_ksOImR7yIGn","timestamp":1611780511705},{"file_id":"1sgGBOKA3KegXZ7hBXUnucZkGledl5Xpc","timestamp":1594839213589},{"file_id":"1eWnGso1T36c2k-4QKnJRVKTJUq7Dy9Dg","timestamp":1594823326964},{"file_id":"1Rjy3aISlh2NGoKPlhP_NSrs2PCpuTEBw","timestamp":1593799068304},{"file_id":"1Dz-dWNxnFHPuVZ3oj65vKswHHY1WF6G0","timestamp":1593118448270},{"file_id":"1EzewkteX2PJu8BKE2vuGBrmKqCTnj5Ds","timestamp":1593022423053},{"file_id":"14Xygd3TBAlumgDxkHVlBXtk5CvLboBH-","timestamp":1590805687351},{"file_id":"1RWCGLVwp-Fg9hfkt8JuHzKcrlRjX832g","timestamp":1589745970408}]},"kernelspec":{"display_name":"Python 3","name":"python3"}},"nbformat":4,"nbformat_minor":0}